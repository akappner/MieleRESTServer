{% extends "config_wizard/base.html" %}
{% block content %}
<h2>{{ title }}</h2>
<p>Provisioning completed. Download generated files and install config.</p>

<form method="post">
    <input type="hidden" name="action" value="submit">
    <div class="field">
        <label for="appliance_type">Appliance Type (used as endpoint key)</label>
        <select id="appliance_type" name="appliance_type">
            {% for appliance_type in appliance_types %}
            <option value="{{ appliance_type }}" {% if state.get('appliance_type') == appliance_type %}selected{% endif %}>{{ appliance_type }}</option>
            {% endfor %}
            <option value="__custom__">custom</option>
        </select>
    </div>

    <div class="field">
        <label for="appliance_type_custom">Custom Appliance Type (if custom selected)</label>
        <input id="appliance_type_custom" name="appliance_type_custom" type="text" placeholder="e.g. steam_oven">
    </div>

    <div class="field">
        <label for="route_override">Route Override (optional)</label>
        <input id="route_override" name="route_override" type="text" placeholder="auto or 12 digits">
        <div class="muted">Default route is derived from serial <code>{{ state.get('device_route', '') }}</code>.</div>
    </div>

    {% if 'device_ip' not in state %}
    <div class="field">
        <label for="device_ip">Appliance IP on Main Wi-Fi</label>
        <input id="device_ip" name="device_ip" type="text" placeholder="192.168.1.50" required>
    </div>
    {% endif %}

    <div class="actions">
        <button class="btn" type="submit">Submit parameters</button>
    </div>
</form>

<hr/>
<h3>Service config</h3>
{% if config_yaml %}
<pre>{{ config_yaml }}</pre>
{% else %}
<p>Some parameters are missing, cannot generate config</p>
{% endif %}

<hr/>
<h3>Device keys</h3>
{% if keys_json %}
<pre>{{ keys_json }}</pre>
{% else %}
<p>Keys info missing in the state, and here is no {{ keys_file }} in the current dir {{ cur_dir }}</p>
{% endif %}


<div class="actions">
    <a class="btn alt" href="{{ url_for('download_wifi') }}">Download wifi.json</a>
</div>

<h3>Install Command</h3>
Save config as <code>MieleRESTServer.config</code> and run the command below. See <code>docx/INSTALL.md</code> for details.
<pre>sudo install -m 0644 MieleRESTServer.config /etc/MieleRESTServer.config</pre>
{% endblock %}


<form method="POST">
    <input type="hidden" name="action" value="submit">

    <div class="actions">
        <button class="btn" type="submit">Finish and Cleanup session</button>
    </div>
</form>